# 数据库表设计

## 设计说明
当你执行`init_chat.sql`之后，会得到下面的数据库。
| 表名             | 字段                         | 说明                                               |
| -------------- | -------------------------- | ------------------------------------------------ |
| User           | id, name, password, state  | 存储用户基本信息，name 唯一，state 表示在线状态                    |
| Friend         | userid, friendid           | 存储好友关系，互为好友只存一条记录，通过 CHECK(userid < friendid) 实现 |
| AllGroup       | id, groupname, groupdesc   | 存储群组信息，群名称唯一                                     |
| GroupUser      | groupid, userid, grouprole | 存储群成员关系，复合主键保证一个用户在同一个群中唯一                       |
| OfflineMessage | id, userid, message        | 存储用户离线消息，一个用户可以有多条消息                             |

约束说明：
* 外键保证数据一致性：用户删除后，其好友关系、群成员关系、离线消息都会自动删除（`ON DELETE CASCADE`）。

* Friend 表的 CHECK(userid < friendid) 保证互为好友只存一条。

* GroupUser 表的复合主键保证同一用户在同一群组中不会重复。

## 初始化数据说明
当你执行`init_chat_data.sql`之后，会在数据库中插入一些示例数据，包括：用户、好友、群组、群成员、离线消息。
### 插入数据后的数据效果

* 用户表 (User)

| id | name    | password | state   |
| -- | ------- | -------- | ------- |
| 1  | alice   | 123456   | offline |
| 2  | bob     | 123456   | offline |
| 3  | charlie | 123456   | online  |
| 4  | david   | 123456   | offline |
| 5  | eva     | 123456   | online  |

* 好友表 (Friend)

| userid | friendid |
| ------ | -------- |
| 1      | 2        |
| 1      | 3        |
| 2      | 4        |
| 3      | 5        |

* 群组表 (AllGroup)

| id | groupname  | groupdesc |
| -- | ---------- | --------- |
| 1  | TechTalk   | 技术讨论群     |
| 2  | GamingClub | 游戏爱好者聚集地  |

* 群成员表 (GroupUser)

| groupid | userid | grouprole |
| ------- | ------ | --------- |
| 1       | 1      | creator   |
| 1       | 2      | normal    |
| 1       | 3      | normal    |
| 2       | 4      | creator   |
| 2       | 5      | normal    |

* 离线消息表 (OfflineMessage)

| id | userid | message                               |
| -- | ------ | ------------------------------------- |
| 1  | 2      | Hi Bob, this is Alice!                |
| 2  | 4      | David, are you coming to the meeting? |
| 3  | 5      | Eva, welcome to the GamingClub!       |

